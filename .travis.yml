language: csharp
solution: ArchUnit.sln
jobs:
  include:
    - stage: linux_build
      dotnet: 2.2.402
      mono: none
      os: linux
      before_script:
        - sudo apt-get install doxygen doxygen-doc graphviz
      script: chmod +x ./Travis/test_linux.sh && ./Travis/test_linux.sh
      after_success:
        # Generate the docs only if master, the travis_build_docs is true and we can use secure variables
        - >-
          if [[ "$TRAVIS_BRANCH" = "master" && "$TRAVIS_PULL_REQUEST" = "false" ]] ; then
            chmod +x ./Travis/setup-ssh.sh ./Travis/generate-documentation.sh
            source ./Travis/setup-ssh.sh || travis_terminate 1
            ./Travis/generate-documentation.sh || travis_terminate 1
          fi
    - stage: windows_build
      mono: none
      os: windows
      before_script:
        - choco install dotnetcore-sdk --version=2.2.402
        - PowerShell -Command 'Set-ExecutionPolicy -ExecutionPolicy RemoteSigned'
      script:
        - PowerShell -File Travis/test_windows.ps1 -tag "$TRAVIS_TAG"
      deploy:
        skip_cleanup: true
        provider: script
        script: PowerShell -File Travis/deploy.ps1 -apiKey $NUGET_API_KEY -source $NUGET_SOURCE
        on:
          tags: true
          all_branches: true
